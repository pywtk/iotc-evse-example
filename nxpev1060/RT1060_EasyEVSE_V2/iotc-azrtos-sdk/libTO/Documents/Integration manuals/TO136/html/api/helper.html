
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Helper API &#8212; libTO 6.1.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/custom.js"></script>
    <script src="../_static/custom.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Secure Element API" href="core.html" />
    <link rel="prev" title="Initialization" href="examples.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">release 6.1.2<br />doc</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Helper API</a><ul>
<li><a class="reference internal" href="#ecies-sequence">ECIES sequence</a><ul>
<li><a class="reference internal" href="#authenticate-the-secure-element">Authenticate the Secure Element</a></li>
<li><a class="reference internal" href="#authenticate-remote">Authenticate remote</a></li>
<li><a class="reference internal" href="#ecies-secure-messaging">ECIES secure messaging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#secure-messaging">Secure messaging</a></li>
<li><a class="reference internal" href="#certificates">Certificates</a></li>
<li><a class="reference internal" href="#tls-handshake">TLS handshake</a><ul>
<li><a class="reference internal" href="#tls-callback-functions-to-define">TLS callback functions to define</a></li>
<li><a class="reference internal" href="#handshake-api">Handshake API</a></li>
<li><a class="reference internal" href="#messaging-api">Messaging API</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="helper-api">
<span id="api-helper"></span><h1>Helper API<a class="headerlink" href="#helper-api" title="Permalink to this headline">¶</a></h1>
<img alt="location into library structure" class="align-right" src="../_images/lib_part_helper.png" />
<p>Helper APIs are high level APIs designed to make integration easier.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;TO_helper.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<div class="section" id="ecies-sequence">
<span id="api-ecies"></span><h2>ECIES sequence<a class="headerlink" href="#ecies-sequence" title="Permalink to this headline">¶</a></h2>
<p>The following functions are an easy-to-use ECIES sequence abstraction. They are
to be called successively to complete the sequence. ECIES is a cipher suite
standardized by ISO 18033.</p>
<p>Steps:</p>
<ul class="simple">
<li><p>authenticate the Secure Element</p></li>
<li><p>authenticate remote device against the Secure Element</p></li>
<li><p>prepare secure messaging</p></li>
</ul>
<p>The two first steps are for mutual authentication between remote device and
the Secure Element, to prevent man-in-the-middle attacks when messaging.</p>
<p>To complete the ECIES sequence, execute the functions below, in order.</p>
<p>To understand what are ‘short’ and ‘standalone’ certificates, please see
Datasheet - Certificates description.</p>
<div class="section" id="authenticate-the-secure-element">
<h3>Authenticate the Secure Element<a class="headerlink" href="#authenticate-the-secure-element" title="Permalink to this headline">¶</a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_ecies_seq_auth_TO">
<span class="target" id="group__helper__ecies__auth__to_1gaaf9805e22e6f36945dafa9d3e0dbb905"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_ecies_seq_auth_TO</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="defs.html#c.TOSE_ctx_t" title="TOSE_ctx_t"><span class="n"><span class="pre">TOSE_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">certificate_index</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">challenge</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="defs.html#c.TO_CHALLENGE_SIZE" title="TO_CHALLENGE_SIZE"><span class="n"><span class="pre">TO_CHALLENGE_SIZE</span></span></a><span class="p"><span class="pre">]</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">TO_certificate</span></span><span class="p"><span class="pre">[</span></span><span class="k"><span class="pre">sizeof</span></span><span class="p"><span class="pre">(</span></span><a class="reference internal" href="defs.html#c.TO_cert_short_t" title="TO_cert_short_t"><span class="n"><span class="pre">TO_cert_short_t</span></span></a><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">]</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">challenge_signature</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="defs.html#c.TO_SIGNATURE_SIZE" title="TO_SIGNATURE_SIZE"><span class="n"><span class="pre">TO_SIGNATURE_SIZE</span></span></a><span class="p"><span class="pre">]</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_ecies_seq_auth_TO" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>ECIES sequence (1st step): authenticate Secure Element. </p>
<p>
This is the ECIES sequence first step, which aims to authenticate Secure Element. It provides a challenge to Secure Element, and get back its certificate and the challenge signed using the private key associated to the certificate.</p>
<p>Refer to Secure Element Datasheet Application Notes - Authenticate Secure Element (and also optimized scheme).</p>
<p>Before call you need to:<ul class="simple">
<li><p>randomly generate a challenge After call you need to:</p></li>
<li><p>check return value (see below)</p></li>
<li><p>verify Secure Element certificate signature using CA public key</p></li>
<li><p>verify challenge signature using Secure Element certificate public key if previous steps are validated, continue with the next ECIES step: TOSE_helper_ecies_seq_auth_remote_1(TOSE_ctx_t *ctx, ) to authenticate the remote device.</p></li>
</ul>
</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – <strong>[in]</strong> Pointer to the SE context </p></li>
<li><p><strong>certificate_index</strong> – <strong>[in]</strong> Index of the Secure Element certificate to use </p></li>
<li><p><strong>challenge</strong> – <strong>[in]</strong> Challenge (randomly generated) to be provided to the Secure Element </p></li>
<li><p><strong>TO_certificate</strong> – <strong>[out]</strong> Short certificate returned by Secure Element </p></li>
<li><p><strong>challenge_signature</strong> – <strong>[out]</strong> Signature of the challenge by Secure Element</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if this step is passed successfully. </p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="authenticate-remote">
<h3>Authenticate remote<a class="headerlink" href="#authenticate-remote" title="Permalink to this headline">¶</a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_ecies_seq_auth_remote_1">
<span class="target" id="group__helper__ecies__auth__remote_1gada042b2882e8eabf1626e5dedd4b424e"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_ecies_seq_auth_remote_1</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="defs.html#c.TOSE_ctx_t" title="TOSE_ctx_t"><span class="n"><span class="pre">TOSE_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">ca_pubkey_index</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">remote_certificate</span></span><span class="p"><span class="pre">[</span></span><span class="k"><span class="pre">sizeof</span></span><span class="p"><span class="pre">(</span></span><a class="reference internal" href="defs.html#c.TO_cert_standalone_t" title="TO_cert_standalone_t"><span class="n"><span class="pre">TO_cert_standalone_t</span></span></a><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">]</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">challenge</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="defs.html#c.TO_CHALLENGE_SIZE" title="TO_CHALLENGE_SIZE"><span class="n"><span class="pre">TO_CHALLENGE_SIZE</span></span></a><span class="p"><span class="pre">]</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_ecies_seq_auth_remote_1" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>ECIES sequence (2nd step): authenticate remote device against Secure Element (part 1) </p>
<p>
This is the ECIES sequence second step, which aims to authenticate remote device (server or other connected object). This first part provides remote device certificate to Secure Element, and get back a random challenge which is going to be used later to authenticate remote device.</p>
<p>There is only one remote certificate at a time. If several shared keys are needed, we can overwrite remote certificate after shared keys computing.</p>
<p>Refer to Secure Element Datasheet Application Notes - Authenticate Remote Device.</p>
<p>Before call you need to:<ul class="simple">
<li><p>have completed previous ECIES sequence steps</p></li>
<li><p>have the remote device certificate After call you need to:</p></li>
<li><p>check return value (see below)</p></li>
<li><p>sign the returned challenge using the remote device certificate private key if previous steps are validated, continue with TOSE_helper_ecies_seq_auth_remote_2(TOSE_ctx_t *ctx, ) to finalize remote device authentication.</p></li>
</ul>
</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – <strong>[in]</strong> Pointer to the SE context </p></li>
<li><p><strong>ca_pubkey_index</strong> – <strong>[in]</strong> Index of Certificate Authority public key </p></li>
<li><p><strong>remote_certificate</strong> – <strong>[in]</strong> Remote device standalone certificate </p></li>
<li><p><strong>challenge</strong> – <strong>[out]</strong> Challenge returned by Secure Element to authenticate remote device</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if this step is passed successfully, else:<ul class="simple">
<li><p>TORSP_BAD_SIGNATURE: the remote device certificate CA signature is invalid </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_ecies_seq_auth_remote_2">
<span class="target" id="group__helper__ecies__auth__remote_1gad763b0021eac39ef654880b5214f21c5"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_ecies_seq_auth_remote_2</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="defs.html#c.TOSE_ctx_t" title="TOSE_ctx_t"><span class="n"><span class="pre">TOSE_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">challenge_signature</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="defs.html#c.TO_SIGNATURE_SIZE" title="TO_SIGNATURE_SIZE"><span class="n"><span class="pre">TO_SIGNATURE_SIZE</span></span></a><span class="p"><span class="pre">]</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_ecies_seq_auth_remote_2" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>ECIES sequence (2nd step): authenticate remote device against Secure Element (part 2) </p>
<p>
This is the ECIES sequence second step, which aims to authenticate remote device (server or other connected object). This second part provides challenge signed using remote device certificate private key.</p>
<p>Refer to Secure Element Datasheet Application Notes - Authenticate Remote Device.</p>
<p>Before call you need to:<ul class="simple">
<li><p>have completed previous ECIES sequence steps</p></li>
<li><p>compute the challenge signature After call you need to:</p></li>
<li><p>check return value (see below) if previous steps are validated, continue with TOSE_helper_ecies_seq_secure_messaging(TOSE_ctx_t *ctx, ).</p></li>
</ul>
</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – <strong>[in]</strong> Pointer to the SE context </p></li>
<li><p><strong>challenge_signature</strong> – <strong>[in]</strong> Challenge signed using remote device certificate private key</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if this step is passed successfully, else:<ul class="simple">
<li><p>TORSP_BAD_SIGNATURE: the challenge signature is invalid </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="ecies-secure-messaging">
<h3>ECIES secure messaging<a class="headerlink" href="#ecies-secure-messaging" title="Permalink to this headline">¶</a></h3>
<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_ecies_seq_secure_messaging">
<span class="target" id="group__helper__ecies__secmsg_1gaf53b0835a1bd3b3ef7c74d5e7dd28570"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_ecies_seq_secure_messaging</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="defs.html#c.TOSE_ctx_t" title="TOSE_ctx_t"><span class="n"><span class="pre">TOSE_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">remote_pubkey_index</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">ecc_keypair_index</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">remote_eph_pubkey</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="defs.html#c.TO_ECC_PUB_KEYSIZE" title="TO_ECC_PUB_KEYSIZE"><span class="n"><span class="pre">TO_ECC_PUB_KEYSIZE</span></span></a><span class="p"><span class="pre">]</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">remote_eph_pubkey_signature</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="defs.html#c.TO_SIGNATURE_SIZE" title="TO_SIGNATURE_SIZE"><span class="n"><span class="pre">TO_SIGNATURE_SIZE</span></span></a><span class="p"><span class="pre">]</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">TO_eph_pubkey</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="defs.html#c.TO_ECC_PUB_KEYSIZE" title="TO_ECC_PUB_KEYSIZE"><span class="n"><span class="pre">TO_ECC_PUB_KEYSIZE</span></span></a><span class="p"><span class="pre">]</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">TO_eph_pubkey_signature</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="defs.html#c.TO_SIGNATURE_SIZE" title="TO_SIGNATURE_SIZE"><span class="n"><span class="pre">TO_SIGNATURE_SIZE</span></span></a><span class="p"><span class="pre">]</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_ecies_seq_secure_messaging" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>ECIES sequence (3rd step): prepare secure data exchange. </p>
<p>
This is the ECIES sequence third step, which aims to prepare secure messaging. Server and connected object will be able to securely exchange data. It provides remote device ephemeral public key signed using remote device certificate private key, and get back Secure Element ephemeral public key.</p>
<p>Secure Element public keys, AES keys, and HMAC keys have the same index to use them from Secure Element APIs.</p>
<p>Refer to Secure Element Datasheet Application Notes - Secure Messaging.</p>
<p>Before call you need to:<ul class="simple">
<li><p>have completed previous ECIES sequence steps</p></li>
<li><p>generate ephemeral key pair</p></li>
<li><p>sign the ephemeral public key using remote device certificate private key.</p></li>
</ul>
</p>
<p>After call you need to:<ul class="simple">
<li><p>check return value (see below)</p></li>
<li><p>check Secure Element ephemeral public key signature using Secure Element certificate public key</p></li>
<li><p>compute shared secret using remote device and Secure Element ephemeral public keys</p></li>
<li><p>derive shared secret with SHA256 to get AES and HMAC keys</p></li>
</ul>
</p>
<p>If previous steps are validated, AES and HMAC keys can be used for secure messaging.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – <strong>[in]</strong> Pointer to the SE context </p></li>
<li><p><strong>remote_pubkey_index</strong> – <strong>[in]</strong> Index where the public key will be stored </p></li>
<li><p><strong>ecc_keypair_index</strong> – <strong>[in]</strong> Index of the ECC key pair to renew </p></li>
<li><p><strong>remote_eph_pubkey</strong> – <strong>[in]</strong> Remote device ephemeral public key </p></li>
<li><p><strong>remote_eph_pubkey_signature</strong> – <strong>[in]</strong> Remote device ephemeral public key signature </p></li>
<li><p><strong>TO_eph_pubkey</strong> – <strong>[out]</strong> Returned Secure Element ephemeral public key </p></li>
<li><p><strong>TO_eph_pubkey_signature</strong> – <strong>[out]</strong> Secure Element ephemeral public key signature</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if this step is passed successfully, else:<ul class="simple">
<li><p>TORSP_BAD_SIGNATURE: the remote device public key signature is invalid </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="secure-messaging">
<span id="api-secmsg-helper"></span><h2>Secure messaging<a class="headerlink" href="#secure-messaging" title="Permalink to this headline">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_secure_payload">
<span class="target" id="group__helper__secmsg_1ga53392f0f0f1ecbf70aef54d67d1e6d8a"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_secure_payload</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="defs.html#c.TOSE_ctx_t" title="TOSE_ctx_t"><span class="n"><span class="pre">TOSE_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">key_index</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="defs.html#c.TO_enc_alg_t" title="TO_enc_alg_t"><span class="n"><span class="pre">TO_enc_alg_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">enc_alg</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="defs.html#c.TO_mac_alg_t" title="TO_mac_alg_t"><span class="n"><span class="pre">TO_mac_alg_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">mac_alg</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">data_len</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">payload</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">payload_len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_secure_payload" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Transforms a message into a secured payload. </p>
<p>
Input (<code class="docutils literal notranslate"><span class="pre">data</span></code>) and output (<code class="docutils literal notranslate"><span class="pre">payload</span></code>) buffers must not be exactly the same. If you want to use the same buffer, you need to shift data from input buffer by <code class="docutils literal notranslate"><span class="pre">TO_SEQUENCE_SIZE</span></code> + <code class="docutils literal notranslate"><span class="pre">TO_INITIALVECTOR_SIZE</span></code> bytes (and send the shifted pointer in <code class="docutils literal notranslate"><span class="pre">data</span></code>).</p>
<p>The MAC tag is calculated on clear data, including sequence counter. This function will add padding after MAC if clear data size is not aligned. Padding scheme is PKCS7 with extra padding length byte (TLS like).</p>
<p>Initial vector is generated by the Secure Element and not included in the data length</p>
<p>You can use following macros to extract parts of payload for advanced usage:<ul class="simple">
<li><p><a class="reference internal" href="#group__helper__secmsg_1ga9bcc038182f4f27447e9870412e41e42"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_SEQUENCE()</span></a></p></li>
<li><p><a class="reference internal" href="#group__helper__secmsg_1ga156a9f25ea4d6ded128a5b262e465ec4"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_SEQUENCE_LEN()</span></a></p></li>
<li><p><a class="reference internal" href="#group__helper__secmsg_1gaa4c0b28b67c38c62c16872afa901a82e"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR()</span></a></p></li>
<li><p><a class="reference internal" href="#group__helper__secmsg_1gaa6e501fb738abaae82d61b011a42b096"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR_LEN()</span></a></p></li>
<li><p><a class="reference internal" href="#group__helper__secmsg_1ga71b0fac15b279045b826b14d744ae917"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_CRYPTOGRAM()</span></a></p></li>
<li><p><a class="reference internal" href="#group__helper__secmsg_1ga4f0577ab17060daed548ec5c4376da1e"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_CRYPTOGRAM_LEN()</span></a></p></li>
</ul>
</p>
<p>Payload length is given by <a class="reference internal" href="defs.html#group__payloads_1ga9cfa8f9832e678d991f90a099e3c7e3c"><span class="std std-ref">TO_PAYLOAD_SECURED_PAYLOAD_SIZE()</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – <strong>[in]</strong> Pointer to the SE context </p></li>
<li><p><strong>key_index</strong> – <strong>[in]</strong> Index of the keys to use for data encryption and MAC, starting from 0 </p></li>
<li><p><strong>enc_alg</strong> – <strong>[in]</strong> Encryption algorithm to use </p></li>
<li><p><strong>mac_alg</strong> – <strong>[in]</strong> MAC algorithm to use </p></li>
<li><p><strong>data</strong> – <strong>[in]</strong> Message to be secured </p></li>
<li><p><strong>data_len</strong> – <strong>[in]</strong> Message length </p></li>
<li><p><strong>payload</strong> – <strong>[out]</strong> Payload </p></li>
<li><p><strong>payload_len</strong> – <strong>[in]</strong> Payload length</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>TORSP_SUCCESS on success</p></li>
<li><p>TORSP_ARG_OUT_OF_RANGE: invalid key index</p></li>
<li><p>TORSP_NOT_AVAILABLE: algorithm not available</p></li>
<li><p>TO_DEVICE_WRITE_ERROR: error writing data to Secure Element</p></li>
<li><p>TO_DEVICE_READ_ERROR: error reading data from Secure Element</p></li>
<li><p>TO_INVALID_RESPONSE_LENGTH: unexpected response length from device</p></li>
<li><p>TO_MEMORY_ERROR: internal I/O buffer overflow</p></li>
<li><p>TO_ERROR: generic error </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_unsecure_payload">
<span class="target" id="group__helper__secmsg_1ga3c946ab1093d20b3c570b7946220a319"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_unsecure_payload</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="defs.html#c.TOSE_ctx_t" title="TOSE_ctx_t"><span class="n"><span class="pre">TOSE_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">key_index</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="defs.html#c.TO_enc_alg_t" title="TO_enc_alg_t"><span class="n"><span class="pre">TO_enc_alg_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">enc_alg</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="defs.html#c.TO_mac_alg_t" title="TO_mac_alg_t"><span class="n"><span class="pre">TO_mac_alg_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">mac_alg</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">payload</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">payload_len</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data_len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_unsecure_payload" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get back a message from a secured payload. </p>
<p>
Input (<code class="docutils literal notranslate"><span class="pre">payload</span></code>) and output (<code class="docutils literal notranslate"><span class="pre">data</span></code>) buffers can be the same buffer.</p>
<p>The MAC tag is verified on clear data, including sequence counter. This function will remove padding. Padding scheme is PKCS7 with extra padding length byte (TLS like).</p>
<p>You can use following macros to extract parts of payload for advanced usage:<ul class="simple">
<li><p><a class="reference internal" href="#group__helper__secmsg_1ga9bcc038182f4f27447e9870412e41e42"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_SEQUENCE()</span></a></p></li>
<li><p><a class="reference internal" href="#group__helper__secmsg_1ga156a9f25ea4d6ded128a5b262e465ec4"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_SEQUENCE_LEN()</span></a></p></li>
<li><p><a class="reference internal" href="#group__helper__secmsg_1gaa4c0b28b67c38c62c16872afa901a82e"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR()</span></a></p></li>
<li><p><a class="reference internal" href="#group__helper__secmsg_1gaa6e501fb738abaae82d61b011a42b096"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR_LEN()</span></a></p></li>
<li><p><a class="reference internal" href="#group__helper__secmsg_1ga71b0fac15b279045b826b14d744ae917"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_CRYPTOGRAM()</span></a></p></li>
<li><p><a class="reference internal" href="#group__helper__secmsg_1ga4f0577ab17060daed548ec5c4376da1e"><span class="std std-ref">TOSE_HELPER_SECURE_PAYLOAD_GET_CRYPTOGRAM_LEN()</span></a></p></li>
</ul>
</p>
<p>Maximal data length is given by <a class="reference internal" href="defs.html#group__payloads_1ga9854e775a3ad79f902baac61a5f1450f"><span class="std std-ref">TO_PAYLOAD_CLEAR_DATA_SIZE()</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – <strong>[in]</strong> Pointer to the SE context </p></li>
<li><p><strong>key_index</strong> – <strong>[in]</strong> Index of the keys to use for data encryption and MAC, starting from 0 </p></li>
<li><p><strong>enc_alg</strong> – <strong>[in]</strong> Encryption algorithm to use </p></li>
<li><p><strong>mac_alg</strong> – <strong>[in]</strong> MAC algorithm to use </p></li>
<li><p><strong>payload</strong> – <strong>[in]</strong> Payload </p></li>
<li><p><strong>payload_len</strong> – <strong>[in]</strong> Payload length </p></li>
<li><p><strong>data</strong> – <strong>[out]</strong> Message unsecured </p></li>
<li><p><strong>data_len</strong> – <strong>[out]</strong> Message length</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>TORSP_SUCCESS on success</p></li>
<li><p>TORSP_ARG_OUT_OF_RANGE: invalid key index</p></li>
<li><p>TORSP_NOT_AVAILABLE: algorithm not available</p></li>
<li><p>TO_DEVICE_WRITE_ERROR: error writing data to Secure Element</p></li>
<li><p>TO_DEVICE_READ_ERROR: error reading data from Secure Element</p></li>
<li><p>TO_INVALID_RESPONSE_LENGTH: unexpected response length from device</p></li>
<li><p>TO_MEMORY_ERROR: internal I/O buffer overflow</p></li>
<li><p>TO_ERROR: generic error </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.TOSE_HELPER_SECURE_PAYLOAD_GET_SEQUENCE">
<span class="target" id="group__helper__secmsg_1ga9bcc038182f4f27447e9870412e41e42"></span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_HELPER_SECURE_PAYLOAD_GET_SEQUENCE</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">payload</span></span><span class="sig-paren">)</span> <span class="pre">((payload)</span> <span class="pre">+</span> <span class="pre">0)</span><a class="headerlink" href="#c.TOSE_HELPER_SECURE_PAYLOAD_GET_SEQUENCE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get sequence pointer from payload pointer </p>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.TOSE_HELPER_SECURE_PAYLOAD_GET_SEQUENCE_LEN">
<span class="target" id="group__helper__secmsg_1ga156a9f25ea4d6ded128a5b262e465ec4"></span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_HELPER_SECURE_PAYLOAD_GET_SEQUENCE_LEN</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="pre">(TO_SEQUENCE_SIZE)</span><a class="headerlink" href="#c.TOSE_HELPER_SECURE_PAYLOAD_GET_SEQUENCE_LEN" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get sequence length </p>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR">
<span class="target" id="group__helper__secmsg_1gaa4c0b28b67c38c62c16872afa901a82e"></span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">payload</span></span><span class="sig-paren">)</span> <span class="pre">(</span><a class="reference internal" href="#group__helper__secmsg_1ga9bcc038182f4f27447e9870412e41e42"><span class="std std-ref"><span class="pre">TOSE_HELPER_SECURE_PAYLOAD_GET_SEQUENCE</span></span></a><span class="pre">(payload)</span> <span class="pre">+</span> <span class="pre">TO_SEQUENCE_SIZE)</span><a class="headerlink" href="#c.TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get initial vector pointer from payload pointer </p>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR_LEN">
<span class="target" id="group__helper__secmsg_1gaa6e501fb738abaae82d61b011a42b096"></span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR_LEN</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">enc_alg</span></span><span class="sig-paren">)</span> <a class="reference internal" href="defs.html#group__payloads_1ga6e57363655b82cf8667b9ee7b8af5ed3"><span class="std std-ref"><span class="pre">TO_PAYLOAD_IV_SIZE</span></span></a><span class="pre">(enc_alg)</span><a class="headerlink" href="#c.TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR_LEN" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get initial_vector length </p>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.TOSE_HELPER_SECURE_PAYLOAD_GET_CRYPTOGRAM">
<span class="target" id="group__helper__secmsg_1ga71b0fac15b279045b826b14d744ae917"></span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_HELPER_SECURE_PAYLOAD_GET_CRYPTOGRAM</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">enc_alg</span></span>, <span class="n"><span class="pre">payload</span></span><span class="sig-paren">)</span> <span class="pre">(</span><a class="reference internal" href="#group__helper__secmsg_1gaa4c0b28b67c38c62c16872afa901a82e"><span class="std std-ref"><span class="pre">TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR</span></span></a><span class="pre">(payload)</span> <span class="pre">+</span> <a class="reference internal" href="#group__helper__secmsg_1gaa6e501fb738abaae82d61b011a42b096"><span class="std std-ref"><span class="pre">TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR_LEN</span></span></a><span class="pre">(enc_alg))</span><a class="headerlink" href="#c.TOSE_HELPER_SECURE_PAYLOAD_GET_CRYPTOGRAM" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get cryptogram pointer from payload pointer </p>
</dd></dl>

<dl class="c macro">
<dt class="sig sig-object c" id="c.TOSE_HELPER_SECURE_PAYLOAD_GET_CRYPTOGRAM_LEN">
<span class="target" id="group__helper__secmsg_1ga4f0577ab17060daed548ec5c4376da1e"></span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_HELPER_SECURE_PAYLOAD_GET_CRYPTOGRAM_LEN</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">enc_alg</span></span>, <span class="n"><span class="pre">payload_len</span></span><span class="sig-paren">)</span> <span class="pre">((payload_len)</span> <span class="pre">-</span> <span class="pre">(TO_SEQUENCE_SIZE)</span> <span class="pre">-</span> <a class="reference internal" href="#group__helper__secmsg_1gaa6e501fb738abaae82d61b011a42b096"><span class="std std-ref"><span class="pre">TOSE_HELPER_SECURE_PAYLOAD_GET_INITIAL_VECTOR_LEN</span></span></a><span class="pre">(enc_alg))</span><a class="headerlink" href="#c.TOSE_HELPER_SECURE_PAYLOAD_GET_CRYPTOGRAM_LEN" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get cryptogram length </p>
</dd></dl>

</div>
<div class="section" id="certificates">
<h2>Certificates<a class="headerlink" href="#certificates" title="Permalink to this headline">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_verify_chain_certificate_and_store">
<span class="target" id="group__helper__certs_1ga9de1e468f74a3d16540d7fb29e64b21d"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_verify_chain_certificate_and_store</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="defs.html#c.TOSE_ctx_t" title="TOSE_ctx_t"><span class="n"><span class="pre">TOSE_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">ca_key_index</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">chain_certificate</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">chain_certificate_length</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_verify_chain_certificate_and_store" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Handle certificate chain at once. </p>
<p>
Certificates must be in X509 DER (binary) format. Certificates must be ordered as following:<ul class="simple">
<li><p>Final certificate</p></li>
<li><p>Intermediate CA certificates (if any)</p></li>
<li><p>Root CA certificate (optional as it must already be trusted by the Secure Element)</p></li>
</ul>
</p>
<p>Each certificate must be signed by the next.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – <strong>[in]</strong> Pointer to the SE context </p></li>
<li><p><strong>ca_key_index</strong> – <strong>[in]</strong> CA key index (use TO_CA_IDX_AUTO to enable Authority Key Identifier based CA detection) </p></li>
<li><p><strong>chain_certificate</strong> – <strong>[in]</strong> Certificate chain </p></li>
<li><p><strong>chain_certificate_length</strong> – <strong>[in]</strong> Certificate chain length</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if data has been sent successfully, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_verify_chain_ca_certificate_and_store">
<span class="target" id="group__helper__certs_1gad6725e2429a82d24f9afc27b9ff9c2a2"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_verify_chain_ca_certificate_and_store</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="defs.html#c.TOSE_ctx_t" title="TOSE_ctx_t"><span class="n"><span class="pre">TOSE_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">ca_key_index</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">subca_key_index</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">chain_certificate</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">chain_certificate_length</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_verify_chain_ca_certificate_and_store" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Handle CA certificate chain at once. </p>
<p>
Certificates must be in X509 DER (binary) format. Certificates must be ordered as following:<ul class="simple">
<li><p>Intermediate CA certificates</p></li>
<li><p>Root CA certificate (optional as it must already be trusted by the Secure Element)</p></li>
</ul>
</p>
<p>Each certificate must be signed by the next.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – <strong>[in]</strong> Pointer to the SE context </p></li>
<li><p><strong>ca_key_index</strong> – <strong>[in]</strong> CA key index (use TO_CA_IDX_AUTO to enable Authority Key Identifier based CA detection) </p></li>
<li><p><strong>subca_key_index</strong> – <strong>[in]</strong> subCA index to store subCA </p></li>
<li><p><strong>chain_certificate</strong> – <strong>[in]</strong> Certificate chain </p></li>
<li><p><strong>chain_certificate_length</strong> – <strong>[in]</strong> Certificate chain length</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if data has been sent successfully, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_set_certificate_x509">
<span class="target" id="group__helper__certs_1gafbbf5c06e5f418a9c1f8dfcc8b2b64f9"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_set_certificate_x509</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="defs.html#c.TOSE_ctx_t" title="TOSE_ctx_t"><span class="n"><span class="pre">TOSE_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">certificate_index</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">certificate</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_set_certificate_x509" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set new certificate from previously generated CSR. </p>
<p>
Set a x509 DER formated certificate according to the given index. The new certificate must be signed by a CA trusted by the Secure Element. Secure Element certificate size cannot exceed TO_CERT_X509_MAXSIZE.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – <strong>[in]</strong> Pointer to the SE context </p></li>
<li><p><strong>certificate_index</strong> – <strong>[in]</strong> Requested certificate index </p></li>
<li><p><strong>certificate</strong> – <strong>[in]</strong> New certificate data (x509 DER formated) </p></li>
<li><p><strong>size</strong> – <strong>[in]</strong> New certificate size</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if certificate has been sent successfully, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_get_certificate_x509_and_sign">
<span class="target" id="group__helper__certs_1gad4fd254310d521649739be92307b60fc"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_get_certificate_x509_and_sign</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="defs.html#c.TOSE_ctx_t" title="TOSE_ctx_t"><span class="n"><span class="pre">TOSE_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">certificate_index</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">challenge</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">challenge_length</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">certificate</span></span>, <span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">size</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">signature</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="defs.html#c.TO_SIGNATURE_SIZE" title="TO_SIGNATURE_SIZE"><span class="n"><span class="pre">TO_SIGNATURE_SIZE</span></span></a><span class="p"><span class="pre">]</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_get_certificate_x509_and_sign" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Returns one of the Secure Element x509 DER formated certificates, and optionnaly a challenge signed with the certificate private key. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – <strong>[inout]</strong> SE context </p></li>
<li><p><strong>certificate_index</strong> – <strong>[in]</strong> Index of the certificate to return, starting from 0 </p></li>
<li><p><strong>challenge</strong> – <strong>[in]</strong> Challenge to be signed, NULL if nothing to sign </p></li>
<li><p><strong>challenge_length</strong> – <strong>[in]</strong> Length of the challenge to be signed, 0 if nothing to sign </p></li>
<li><p><strong>certificate</strong> – <strong>[out]</strong> Returned certificate data, this buffer should be at least TO_CERT_X509_MAXSIZE </p></li>
<li><p><strong>size</strong> – <strong>[inout]</strong> input: the certificate’s buffer size, output: the certificate’s real size </p></li>
<li><p><strong>signature</strong> – <strong>[out]</strong> Returned signature, NULL if nothing to sign</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>TORSP_SUCCESS on success</p></li>
<li><p>TORSP_INVALID_LEN: wrong length</p></li>
<li><p>TORSP_NOT_AVAILABLE: certificate Format not supported</p></li>
<li><p>TORSP_ARG_OUT_OF_RANGE: invalid Certificate Number</p></li>
<li><p>TO_DEVICE_WRITE_ERROR: error writing data to Secure Element</p></li>
<li><p>TO_DEVICE_READ_ERROR: error reading data from Secure Element</p></li>
<li><p>TO_ERROR: generic error </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="tls-handshake">
<span id="api-tls-helper"></span><h2>TLS handshake<a class="headerlink" href="#tls-handshake" title="Permalink to this headline">¶</a></h2>
<p>TLS Helper is a set of functions making TLS handshake easy to integrate.</p>
<p>It only requires to provide 2 callbacks to physically send and receive data.</p>
<div class="section" id="tls-callback-functions-to-define">
<h3>TLS callback functions to define<a class="headerlink" href="#tls-callback-functions-to-define" title="Permalink to this headline">¶</a></h3>
<p>These callbacks need to be implemented and passed to TLS helper APIs to be able
to send / receive data to / from the server.</p>
<dl class="c type">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_send_func">
<span class="target" id="group__helper__tls__defs_1gaee7ed3b4512652bd0252d86dfe90353c"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_send_func</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">priv_ctx</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.TOSE_helper_tls_send_func" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Handshake helper network send function. </p>
<p>
This function is used by “TOSE_helper_tls_handshake” to send data on the network.</p>
<dl class="field-list simple">
<dt class="field-odd">Param priv_ctx</dt>
<dd class="field-odd"><p><strong>[in]</strong> Opaque context given to “TOSE_helper_tls_handshake” </p>
</dd>
<dt class="field-even">Param data</dt>
<dd class="field-even"><p><strong>[in]</strong> Data to send </p>
</dd>
<dt class="field-odd">Param len</dt>
<dd class="field-odd"><p><strong>[in]</strong> Length of data</p>
</dd>
<dt class="field-even">Return</dt>
<dd class="field-even"><p>TO_OK if data has been sent successfully, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c type">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_receive_func">
<span class="target" id="group__helper__tls__defs_1gad3c838d43f50ccc67e6cfad8eefdd845"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_receive_func</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">priv_ctx</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">read_len</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="n"><span class="pre">timeout</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.TOSE_helper_tls_receive_func" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Handshake helper network receive function. </p>
<p>
This function is used by “TOSE_helper_tls_handshake” to receive data from the network.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>#TO_AGAIN may be returned for example when this callback is implemented with POSIX’ recv(), and recv() returns #EINTR </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Param priv_ctx</dt>
<dd class="field-odd"><p><strong>[in]</strong> Opaque context given to “TOSE_helper_tls_handshake” </p>
</dd>
<dt class="field-even">Param data</dt>
<dd class="field-even"><p><strong>[in]</strong> Data output </p>
</dd>
<dt class="field-odd">Param len</dt>
<dd class="field-odd"><p><strong>[in]</strong> Length of data to read </p>
</dd>
<dt class="field-even">Param read_len</dt>
<dd class="field-even"><p><strong>[out]</strong> Length of data read </p>
</dd>
<dt class="field-odd">Param timeout</dt>
<dd class="field-odd"><p><strong>[in]</strong> Receive timeout in milliseconds (-1 for no timeout)</p>
</dd>
<dt class="field-even">Retval TO_OK</dt>
<dd class="field-even"><p>if some data has been received successfully, read_len is updated and &gt;0 </p>
</dd>
<dt class="field-odd">Retval TO_TIMEOUT</dt>
<dd class="field-odd"><p>timed out elapsed before any data was available </p>
</dd>
<dt class="field-even">Retval TO_AGAIN</dt>
<dd class="field-even"><p>the function has been interrupted before receiving any data </p>
</dd>
<dt class="field-odd">Retval TO_ERROR</dt>
<dd class="field-odd"><p>Other error</p>
</dd>
</dl>
</dd></dl>

<dl class="c type">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_unsecure_record">
<span class="target" id="group__helper__tls__defs_1ga1197e36b8314b8c9d1fcb6933915263f"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><a class="reference internal" href="defs.html#c.TO_ret_t" title="TO_ret_t"><span class="n"><span class="pre">TO_ret_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_unsecure_record</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">header_length</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">in</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">in_length</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">out</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">out_length</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.TOSE_helper_tls_unsecure_record" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>callback to unsecure a received protected record (HANDSHAKE_ONLY_MODE) </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The in parameter isn’t const because the callback can reuse it to unsecure in place provided it doesn’t write above in_length. For example if it uses hardware decryption with constraints on memory regions used by the DMA. </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Param ctx</dt>
<dd class="field-odd"><p><strong>[inout]</strong> cipher context </p>
</dd>
<dt class="field-even">Param header_length</dt>
<dd class="field-even"><p><strong>[in]</strong> length of the record’s header </p>
</dd>
<dt class="field-odd">Param in</dt>
<dd class="field-odd"><p><strong>[in]</strong> input buffer containing the entire protected record (e.g. with the header) </p>
</dd>
<dt class="field-even">Param in_length</dt>
<dd class="field-even"><p><strong>[in]</strong> length of the protected record in the input buffer </p>
</dd>
<dt class="field-odd">Param out</dt>
<dd class="field-odd"><p><strong>[out]</strong> buffer with the plain text content of the record (e.g. without the header) </p>
</dd>
<dt class="field-even">Param out_length</dt>
<dd class="field-even"><p><strong>[out]</strong> length of the plain text content</p>
</dd>
<dt class="field-odd">Retval TO_OK</dt>
<dd class="field-odd"><p>if the record is authenticated and decrypted </p>
</dd>
<dt class="field-even">Retval TO_ERROR</dt>
<dd class="field-even"><p>Otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="c type">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_secure_record">
<span class="target" id="group__helper__tls__defs_1gaaa0c21af2edd1d4ad89d52df60f6e733"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><a class="reference internal" href="defs.html#c.TO_ret_t" title="TO_ret_t"><span class="n"><span class="pre">TO_ret_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_secure_record</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">hdr</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">hdr_length</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">in</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">in_length</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">out</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">out_length</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.TOSE_helper_tls_secure_record" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>callback to secure a plain text record before sending (HANDSHAKE_ONLY_MODE) </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>input and output buffers provided by the caller may overlap with a gap of at least 1 AES block (*out + hdr_length + AES_BLOCK_LEN &lt;= in). </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Param ctx</dt>
<dd class="field-odd"><p><strong>[inout]</strong> cipher context </p>
</dd>
<dt class="field-even">Param hdr</dt>
<dd class="field-even"><p><strong>[in]</strong> plain text record header buffer </p>
</dd>
<dt class="field-odd">Param hdr_length</dt>
<dd class="field-odd"><p><strong>[in]</strong> plain text record header length </p>
</dd>
<dt class="field-even">Param in</dt>
<dd class="field-even"><p><strong>[in]</strong> input buffer with the plain text record’s content data (e.g. withot header) </p>
</dd>
<dt class="field-odd">Param in_length</dt>
<dd class="field-odd"><p><strong>[in]</strong> length of the plain text record’s content data </p>
</dd>
<dt class="field-even">Param out</dt>
<dd class="field-even"><p><strong>[inout]</strong> output buffer with the ciphered content of the protected record</p>
</dd>
<dt class="field-odd">Retval TO_OK</dt>
<dd class="field-odd"><p>if the record cannot be encrypted </p>
</dd>
<dt class="field-even">Retval TO_ERROR</dt>
<dd class="field-even"><p>Otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="c type">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_setup_cipher_ctx">
<span class="target" id="group__helper__tls__defs_1gab431adaa0e624f54721c9c9c9d1c4a12"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><a class="reference internal" href="defs.html#c.TO_ret_t" title="TO_ret_t"><span class="n"><span class="pre">TO_ret_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_setup_cipher_ctx</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">cipher_suite</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">key_block</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">key_block_length</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cipher_overhead_length</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#c.TOSE_helper_tls_unsecure_record" title="TOSE_helper_tls_unsecure_record"><span class="n"><span class="pre">TOSE_helper_tls_unsecure_record</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">unsecure_record</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#c.TOSE_helper_tls_secure_record" title="TOSE_helper_tls_secure_record"><span class="n"><span class="pre">TOSE_helper_tls_secure_record</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">secure_record</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#c.TOSE_helper_tls_setup_cipher_ctx" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>callback to setup the cipher context (HANDSHAKE_ONLY_MODE) </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This callback is called during the handshake after the cipher suite is negotiated with the server and before extracting the derived key from the Secure Element.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Param ctx</dt>
<dd class="field-odd"><p><strong>[inout]</strong> cipher context </p>
</dd>
<dt class="field-even">Param cipher_suite</dt>
<dd class="field-even"><p><strong>[in]</strong> the negociated cipher_suite identifier (as specified in TLS RFCs) </p>
</dd>
<dt class="field-odd">Param key_block</dt>
<dd class="field-odd"><p><strong>[out]</strong> pointer on the key block where key derivation from master secret is stored </p>
</dd>
<dt class="field-even">Param key_block_length</dt>
<dd class="field-even"><p><strong>[out]</strong> length of the key block, depends upon the negociated cipher suite </p>
</dd>
<dt class="field-odd">Param cipher_overhead_length</dt>
<dd class="field-odd"><p><strong>[inout]</strong> the maximum difference of length between the plain text content and the ciphered text content. The caller provides its own value if possible, the callee can lower it to 0 if it provides its own buffer to store protected records. </p>
</dd>
<dt class="field-even">Param unsecure_record</dt>
<dd class="field-even"><p><strong>[out]</strong> callback used to authenticate and decrypt incoming records </p>
</dd>
<dt class="field-odd">Param secure_record</dt>
<dd class="field-odd"><p><strong>[out]</strong> callback used to encrypt data to the outcoming records</p>
</dd>
<dt class="field-even">Retval TO_OK</dt>
<dd class="field-even"><p>if setup completed correctly </p>
</dd>
<dt class="field-odd">Retval TO_ERROR</dt>
<dd class="field-odd"><p>Otherwise </p>
</dd>
</dl>
</dd></dl>

<dl class="c type">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_ctx_t">
<span class="target" id="group__helper__tls__defs_1gaff3d27f907e00365a49819c44dab91aa"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">TOSE_helper_tls_ctx_s</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></span><a class="headerlink" href="#c.TOSE_helper_tls_ctx_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Opaque TLS helper context </p>
</dd></dl>

</div>
<div class="section" id="handshake-api">
<h3>Handshake API<a class="headerlink" href="#handshake-api" title="Permalink to this headline">¶</a></h3>
<p>Calling one function will do all the steps of the TLS handshake.</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.default_cipher_ctx">
<span class="target" id="group__helper__tls__handshake_1ga324f3c78e3f10297d7cf03ac6a1c486e"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">default_cipher_ctx</span></span></span><a class="headerlink" href="#c.default_cipher_ctx" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>default cipher context when NULL is passed to <a class="reference internal" href="#group__helper__tls__handshake_1ga0e624e66476656861c7c17c8558b14d6"><span class="std std-ref">TOSE_helper_tls_set_mode_handshake_only()</span></a> </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.default_setup_cipher_ctx">
<span class="target" id="group__helper__tls__handshake_1ga61d1a96a1e4a6e76eb58ca2ca37bf146"></span><a class="reference internal" href="#c.TOSE_helper_tls_setup_cipher_ctx" title="TOSE_helper_tls_setup_cipher_ctx"><span class="n"><span class="pre">TOSE_helper_tls_setup_cipher_ctx</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">default_setup_cipher_ctx</span></span></span><a class="headerlink" href="#c.default_setup_cipher_ctx" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>default setup cipher context when NULL is passed to <a class="reference internal" href="#group__helper__tls__handshake_1ga0e624e66476656861c7c17c8558b14d6"><span class="std std-ref">TOSE_helper_tls_set_mode_handshake_only()</span></a> </p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_init_session">
<span class="target" id="group__helper__tls__handshake_1ga3adbd84cbe7c2212b5556172da040ac4"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_init_session</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="defs.html#c.TOSE_ctx_t" title="TOSE_ctx_t"><span class="n"><span class="pre">TOSE_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">ctx</span></span>, <a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">session</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">priv_ctx</span></span>, <a class="reference internal" href="#c.TOSE_helper_tls_send_func" title="TOSE_helper_tls_send_func"><span class="n"><span class="pre">TOSE_helper_tls_send_func</span></span></a><span class="w"> </span><span class="n"><span class="pre">send_func</span></span>, <a class="reference internal" href="#c.TOSE_helper_tls_receive_func" title="TOSE_helper_tls_receive_func"><span class="n"><span class="pre">TOSE_helper_tls_receive_func</span></span></a><span class="w"> </span><span class="n"><span class="pre">receive_func</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_init_session" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Initialize TLS handshake. </p>
<p>
This function initialize TLS handshake. It configures the Secure Element and initialize static envrionment.</p>
<p>Each initialized session must be cleaned with <a class="reference internal" href="#group__helper__tls__handshake_1gaa7967d6bef25fdd3c71005ef7ca5b40d"><span class="std std-ref">TOSE_helper_tls_cleanup()</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ctx</strong> – <strong>[in]</strong> Pointer to the SE context </p></li>
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context assigned </p></li>
<li><p><strong>session</strong> – <strong>[in]</strong> TLS session to use </p></li>
<li><p><strong>priv_ctx</strong> – <strong>[in]</strong> Opaque context to forward to given functions </p></li>
<li><p><strong>send_func</strong> – <strong>[in]</strong> Function to send on network </p></li>
<li><p><strong>receive_func</strong> – <strong>[in]</strong> Function to receive from network</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if initialization succeed, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_close">
<span class="target" id="group__helper__tls__handshake_1ga3225351bdd42280baf457bdf5b3c8767"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_close</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_close" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Close TLS handshake. </p>
<p>
This function closes TLS handshake by sending a close notify alert to the TLS server. Given context must not be used anymore. In TCP, the socket used by this session might not be usable anymore due to close notify alert.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if close succeed, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_fini">
<span class="target" id="group__helper__tls__handshake_1ga5b9b5df0d8dbc1dda8b40f7e4837360d"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_fini</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_fini" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Finalize TLS context. </p>
<p>
It is needed to call this function if TCP socket closed for any reason.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if finalize succeed, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_cleanup">
<span class="target" id="group__helper__tls__handshake_1gaa7967d6bef25fdd3c71005ef7ca5b40d"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_cleanup</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_cleanup" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Cleanup TLS handshake. </p>
<p>
This function closes and finalizes TLS handshake and session using TOSE_helper_tls_close and TOSE_helper_tls_fini.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if cleanup succeed, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_set_retransmission_timeout">
<span class="target" id="group__helper__tls__handshake_1gab147ba9523f98dc407830dab72e2c80f"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_set_retransmission_timeout</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">min_timeout</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">max_timeout</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_set_retransmission_timeout" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set DTLS retransmission timeout min/max values. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context </p></li>
<li><p><strong>min_timeout</strong> – <strong>[in]</strong> Minimal (initial) retransmission timeout, in milliseconds </p></li>
<li><p><strong>max_timeout</strong> – <strong>[in]</strong> Maximal retransmission timeout, in milliseconds</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if cleanup succeed, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_set_retransmission_max">
<span class="target" id="group__helper__tls__handshake_1gac9071b4f53dc7c3c319f9a199903b87c"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_set_retransmission_max</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">max_retransmissions</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_set_retransmission_max" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set DTLS retransmission max value. </p>
<p>
Retransmission counter is reset in case of successful receive.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context </p></li>
<li><p><strong>max_retransmissions</strong> – <strong>[in]</strong> Maximal retransmissions count</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if cleanup succeed, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_set_fragment_max_size">
<span class="target" id="group__helper__tls__handshake_1ga715acc9b89625bb123defc464ef11532"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_set_fragment_max_size</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">max_size</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_set_fragment_max_size" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set DTLS fragment maximum size. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context </p></li>
<li><p><strong>max_size</strong> – <strong>[in]</strong> Maximum fragment size in bytes (record &amp; handshake headers excluded)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if cleanup succeed, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_set_cipher_suites">
<span class="target" id="group__helper__tls__handshake_1ga08988c260a825cd34aa0345395b07033"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_set_cipher_suites</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cipher_suites</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint16_t</span></span><span class="w"> </span><span class="n"><span class="pre">cipher_suites_cnt</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_set_cipher_suites" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set cipher suites list. </p>
<p>
cipher_suites values must be values defined in helper header (TO_TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256, etc)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context </p></li>
<li><p><strong>cipher_suites</strong> – <strong>[in]</strong> Array of cipher suites (array of 16-bits integer values. See TO_tls_cipher_suite_e.) </p></li>
<li><p><strong>cipher_suites_cnt</strong> – <strong>[in]</strong> Cipher suites count</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK in case of success, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_set_config_mode">
<span class="target" id="group__helper__tls__handshake_1ga1c998ed242990c1fefe2eaaea9ad6c5c"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_set_config_mode</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <a class="reference internal" href="defs.html#c.TO_tls_mode_t" title="TO_tls_mode_t"><span class="n"><span class="pre">TO_tls_mode_t</span></span></a><span class="w"> </span><span class="n"><span class="pre">mode</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_set_config_mode" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set configuration mode of the TLS session. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>updating the mode is persistent across reboot.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context </p></li>
<li><p><strong>mode</strong> – <strong>[in]</strong> configuration mode (see TO_tls_mode_e)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK in case of success, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_set_config_certificate_slot">
<span class="target" id="group__helper__tls__handshake_1ga3f6d3744f51b434a41ade39e8015e9c4"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_set_config_certificate_slot</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="n"><span class="pre">certificate_slot</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_set_config_certificate_slot" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Configure client certificate slot of the TLS session. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>updating the certificate slot is persistent across reboot.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context </p></li>
<li><p><strong>mode</strong> – <strong>[in]</strong> client certificate mode</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK in case of success, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_set_server_name">
<span class="target" id="group__helper__tls__handshake_1gacd07c86c7c565a4fcae85ef6271d392a"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_set_server_name</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">server_name</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_set_server_name" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Configure the server’s domain name. </p>
<p>When the server name is configured, it is used during handshake within the SNI extension (section 3 - RFC 6066)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>server_name may be NULL or empty, in that case the TLS context is configured to not use the SNI extension.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[inout]</strong> context of the TLS session </p></li>
<li><p><strong>server_name</strong> – <strong>[in]</strong> a string with the server’s domain name</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TO_OK</strong> – the server name is configured inside the TLS context </p></li>
<li><p><strong>TO_ERROR</strong> – the server name configuration failed </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_set_mode_handshake_only">
<span class="target" id="group__helper__tls__handshake_1ga0e624e66476656861c7c17c8558b14d6"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_set_mode_handshake_only</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cipher_ctx</span></span>, <a class="reference internal" href="#c.TOSE_helper_tls_setup_cipher_ctx" title="TOSE_helper_tls_setup_cipher_ctx"><span class="n"><span class="pre">TOSE_helper_tls_setup_cipher_ctx</span></span></a><span class="w"> </span><span class="n"><span class="pre">setup_cipher_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_set_mode_handshake_only" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>configure the TLS session in HANDSHAKE_ONLY_MODE </p>
<p>In this mode the encryption and decryption of TLS records is delegated to the upper layer. This layer shall provide a set of callbacks to be called by the libTO to transmit the key block and to secure/unsecure records.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The callback <code class="docutils literal notranslate"><span class="pre">setup_cipher_ctx</span></code> can been NULL if the libTO has been built with a default callback enabled. In that case the parameter <code class="docutils literal notranslate"><span class="pre">cipher_ctx</span></code> is ignored.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function shall be called with a initialized tls_ctx, so after calling <a class="reference internal" href="#group__helper__tls__handshake_1ga3adbd84cbe7c2212b5556172da040ac4"><span class="std std-ref">TOSE_helper_tls_init_session()</span></a>, and it shall be called before starting a handshake, so before <a class="reference internal" href="#group__helper__tls__handshake_1ga5fd67412eb0bedf8b0e20d6574713612"><span class="std std-ref">TOSE_helper_tls_do_handshake()</span></a> The following sequence show the calls needed to use the mode Handshake Only with the default cipher in AES128-GCM: <div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">function</span> <span class="n">returns</span> <span class="n">are</span> <span class="n">ignored</span> <span class="k">for</span> <span class="n">compactness</span> <span class="n">but</span> <span class="n">should</span> <span class="n">be</span> <span class="n">handled</span> <span class="ow">in</span>
<span class="o">//</span> <span class="n">production</span> <span class="n">code</span><span class="o">.</span>
<span class="c1">#define CIPHER_SUITE_CNT 2</span>
<span class="n">uint16_t</span> <span class="n">cipher_suites</span><span class="p">[</span><span class="n">CIPHER_SUITE_CNT</span><span class="p">]</span> <span class="o">=</span>
            <span class="p">{</span><span class="n">TO_TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</span><span class="p">,</span>
            <span class="n">TO_TLS_PSK_WITH_AES_128_GCM_SHA256</span><span class="p">};</span>
<span class="n">TOSE_helper_tls_ctx_t</span> <span class="o">*</span><span class="n">tls_ctx</span><span class="p">;</span>
<span class="n">TOSE_helper_tls_init_session</span><span class="p">(</span><span class="n">DEFAULT_CTX</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tls_ctx</span><span class="p">,</span> <span class="n">session_slot</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">your_recv_send_ctx</span><span class="p">,</span> <span class="n">your_send_func</span><span class="p">,</span> <span class="n">your_receive_func</span><span class="p">);</span>
<span class="n">TOSE_helper_tls_set_cipher_suites</span><span class="p">(</span><span class="n">tls_ctx</span><span class="p">,</span> <span class="o">//</span> <span class="n">setting</span> <span class="n">the</span> <span class="n">cipher</span> <span class="n">suite</span> <span class="ow">is</span> <span class="n">optional</span>
            <span class="n">cipher_suites</span><span class="p">,</span>     <span class="o">//</span> <span class="k">if</span> <span class="n">the</span> <span class="n">server</span> <span class="ow">is</span> <span class="n">known</span> <span class="n">to</span> <span class="n">always</span>
            <span class="n">CIPHER_SUITE_CNT</span><span class="p">);</span> <span class="o">//</span> <span class="n">choose</span> <span class="n">an</span> <span class="n">AES</span><span class="o">-</span><span class="n">GCM</span> <span class="n">cipher</span> <span class="n">suite</span>
<span class="n">TOSE_helper_tls_set_mode_handshake_only</span><span class="p">(</span><span class="n">tls_ctx</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
<span class="n">TOSE_helper_tls_do_handshake</span><span class="p">(</span><span class="n">tls_ctx</span><span class="p">);</span>
</pre></div>
</div>
</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Once the handshake is completed. The Secure Element can be shutdown with <a class="reference internal" href="core.html#group__setup_1gace267d62bf78ff0f249ea9168c970af8"><span class="std std-ref">TOSE_fini()</span></a> as the encryption/decryption/authentication of payloads are done at the library layer.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Setting the mode Handshake Only has for effect to change the persistent configuration of the Secure Element. In order to go back to the mode Full TLS, the session shall be re-configured using the following sequence: <div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">function</span> <span class="n">returns</span> <span class="n">are</span> <span class="n">ignored</span> <span class="k">for</span> <span class="n">compactness</span> <span class="n">but</span> <span class="n">should</span> <span class="n">be</span> <span class="n">handled</span> <span class="ow">in</span>
<span class="o">//</span> <span class="n">production</span> <span class="n">code</span><span class="o">.</span>
<span class="n">TOSE_helper_tls_ctx_t</span> <span class="o">*</span><span class="n">tls_ctx</span><span class="p">;</span>
<span class="n">TOSE_helper_tls_init_session</span><span class="p">(</span><span class="n">DEFAULT_CTX</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tls_ctx</span><span class="p">,</span> <span class="n">session_slot</span><span class="p">,</span>
            <span class="o">&amp;</span><span class="n">your_recv_send_ctx</span><span class="p">,</span> <span class="n">your_send_func</span><span class="p">,</span> <span class="n">your_receive_func</span><span class="p">);</span>
<span class="n">TOSE_helper_tls_set_mode</span><span class="p">(</span><span class="n">tls_ctx</span><span class="p">,</span> <span class="n">TO_TLS_MODE_TLS_1_2_FULL</span><span class="p">);</span>
<span class="n">TOSE_helper_tls_do_handshake</span><span class="p">(</span><span class="n">tls_ctx</span><span class="p">);</span>
</pre></div>
</div>
</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[inout]</strong> context of the TLS session </p></li>
<li><p><strong>cipher_ctx</strong> – <strong>[in]</strong> private cipher context given to the callbacks </p></li>
<li><p><strong>setup_cipher_ctx</strong> – <strong>[in]</strong> callback used to setup the cipher context, call during the TLS handshake after cipher suite have been negotiated.</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TO_OK</strong> – the TLS session switched to HANDSHAKE_ONLY_MODE </p></li>
<li><p><strong>TO_ERROR</strong> – the TLS session didn’t switch to HANDSHAKE_ONLY_MODE </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_do_handshake_step">
<span class="target" id="group__helper__tls__handshake_1ga557f4699e6d49085f183e54b7dca5f09"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_do_handshake_step</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_do_handshake_step" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Do TLS handshake step. </p>
<p>
This function does one step of a TLS handshake. It encapsulates Secure Element payloads from optimized API in a TLS record, and sends it on the network through given function. It decapsulates TLS records received from the network and sends it to the Secure Element.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_AGAIN if intermediate step suceed, TO_OK if last step succeed, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_do_handshake">
<span class="target" id="group__helper__tls__handshake_1ga5fd67412eb0bedf8b0e20d6574713612"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_do_handshake</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_do_handshake" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Do TLS handshake. </p>
<p>
This function does all the steps of a TLS handshake except initialization and cleanup. It encapsulates the Secure Element payloads from optimized API in a TLS record, and sends it on the network through given function. It decapsulates TLS records received from the network and sends it to the Secure Element. This function uses TOSE_helper_tls_handshake_init() and TOSE_helper_tls_handshake_step().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if data has been sent successfully, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_get_certificate_slot">
<span class="target" id="group__helper__tls__handshake_1ga057c935935407857caa61f63a122f259"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_get_certificate_slot</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">slot</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_get_certificate_slot" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get certificate slot used during TLS handshake. </p>
<p>
This function must be called after handshake.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context </p></li>
<li><p><strong>slot</strong> – <strong>[out]</strong> Certificate slot</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if slot has been retrieved successfully, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="messaging-api">
<h3>Messaging API<a class="headerlink" href="#messaging-api" title="Permalink to this headline">¶</a></h3>
<p>Once handshake is done, these 2 functions will allow to send and receive with
TLS encryption using just negociated session.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_send">
<span class="target" id="group__helper__tls__messaging_1ga1698630f6af11c017952571ea2105bbd"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_send</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msg</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">msg_len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_send" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Send TLS encrypted data. </p>
<p>
This function uses TLS handshake keys to encrypt and send a message on the network through given function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context </p></li>
<li><p><strong>msg</strong> – <strong>[in]</strong> Message </p></li>
<li><p><strong>msg_len</strong> – <strong>[in]</strong> Message length</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if message has been sent successfully, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_receive">
<span class="target" id="group__helper__tls__messaging_1gabde1b04b7a16240c2c51a42dc52dcc73"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_receive</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msg</span></span>, <span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">max_msg_len</span></span>, <span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msg_len</span></span>, <span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="n"><span class="pre">timeout</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_receive" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Receive TLS encrypted data. </p>
<p>
This function uses given function to receive a message from the network and decrypts it with TLS handshake keys.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[in]</strong> TLS context </p></li>
<li><p><strong>msg</strong> – <strong>[out]</strong> Message output buffer </p></li>
<li><p><strong>max_msg_len</strong> – <strong>[in]</strong> Message output buffer length </p></li>
<li><p><strong>msg_len</strong> – <strong>[out]</strong> Receive message length </p></li>
<li><p><strong>timeout</strong> – <strong>[in]</strong> Receive timeout in milliseconds (-1 for no timeout)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if message has been received successfully, TO_TIMEOUT if given timeout has been exceeded, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TOSE_helper_tls_recv">
<span class="target" id="group__helper__tls__messaging_1ga40dfb80d5dd5fd3d9eb54b67ca5dd359"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TOSE_helper_tls_recv</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.TOSE_helper_tls_ctx_t" title="TOSE_helper_tls_ctx_t"><span class="n"><span class="pre">TOSE_helper_tls_ctx_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tls_ctx</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msg</span></span>, <span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="n"><span class="pre">max_msg_len</span></span>, <span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msg_len</span></span>, <span class="n"><span class="pre">int32_t</span></span><span class="w"> </span><span class="n"><span class="pre">timeout_ms</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TOSE_helper_tls_recv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>receive plain text application data </p>
<p>More precisely, receives at most a plain text record of type application data, less if the receiving buffer is too short or if a record has been partially received previously.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the parameter timeout_ms is given to the receive_func() callback provided to <a class="reference internal" href="#group__helper__tls__handshake_1ga3adbd84cbe7c2212b5556172da040ac4"><span class="std std-ref">TOSE_helper_tls_init_session()</span></a>. To ensure to not block more than timeout_ms, the recv() callback is called just once, thus the #TO_AGAIN retval if partial data has been received. </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tls_ctx</strong> – <strong>[inout]</strong> the TLS context </p></li>
<li><p><strong>msg</strong> – <strong>[out]</strong> received data </p></li>
<li><p><strong>max_msg_len</strong> – <strong>[in]</strong> maximum length of data writable in msg </p></li>
<li><p><strong>msg_len</strong> – <strong>[out]</strong> number of bytes read </p></li>
<li><p><strong>timeout_ms</strong> – <strong>[in]</strong> the maximum time to wait data in milliseconds</p></li>
</ul>
</dd>
<dt class="field-even">Return values</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TO_OK</strong> – application data received with success, msg is updated and *msg_len is greater than 0 </p></li>
<li><p><strong>TO_AGAIN</strong> – some data has been received but not enough to receive a complete record, or it was not application data (see note above) </p></li>
<li><p><strong>TO_TIMEOUT</strong> – timeout elapsed before any bytes were received </p></li>
<li><p><strong>TO_ERROR</strong> – data cannot be received, the connection shall be (re-)initialized</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2017, Trusted Objects.
      
    </div>

    

    
  </body>
</html>