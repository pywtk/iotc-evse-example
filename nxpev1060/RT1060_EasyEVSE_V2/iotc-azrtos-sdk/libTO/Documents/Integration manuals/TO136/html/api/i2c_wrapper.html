
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>I2C wrapper API &#8212; libTO 6.1.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/custom.js"></script>
    <script src="../_static/custom.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Library core APIs" href="lib.html" />
    <link rel="prev" title="Secure Element API" href="core.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">release 6.1.2<br />doc</p>







<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">I2C wrapper API</a><ul>
<li><a class="reference internal" href="#types-and-definitions">Types and definitions</a></li>
<li><a class="reference internal" href="#i2c-bus-setup">I2C bus setup</a></li>
<li><a class="reference internal" href="#data-transfers">Data transfers</a></li>
<li><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
</ul>

  </div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="i2c-wrapper-api">
<span id="api-i2c-wrapper"></span><h1>I2C wrapper API<a class="headerlink" href="#i2c-wrapper-api" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These APIs are <strong>not</strong> to be called externally, only the library
should rely on them.</p>
</div>
<img alt="location into library structure" class="align-right" src="../_images/lib_part_wrapperapi.png" />
<p>This API is implemented by every libTO I2C wrapper. The following functions
have to be implemented in order to develop a new wrapper for a new I2C master
device.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;TODRV_HSE_i2c_wrapper.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<div class="section" id="types-and-definitions">
<h2>Types and definitions<a class="headerlink" href="#types-and-definitions" title="Permalink to this headline">¶</a></h2>
<p>The following structure type is used to configure I2C wrapper:</p>
<dl class="c struct">
<dt class="sig sig-object c" id="c.TO_i2c_config_s">
<span class="target" id="structTO__i2c__config__s"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TO_i2c_config_s</span></span></span><a class="headerlink" href="#c.TO_i2c_config_s" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>I2C wrapper configuration. </p>
<p>To be used through TO_data_config(). </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="c var">
<dt class="sig sig-object c" id="c.TO_i2c_config_s.i2c_addr">
<span class="target" id="structTO__i2c__config__s_1a4638bccda7315c904704109dd72e6dda"></span><span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">i2c_addr</span></span></span><a class="headerlink" href="#c.TO_i2c_config_s.i2c_addr" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Device I2C address on 7 bits (MSB=0) </p>
</dd></dl>

<dl class="c var">
<dt class="sig sig-object c" id="c.TO_i2c_config_s.misc_settings">
<span class="target" id="structTO__i2c__config__s_1aad27d07ad8ac29413136c7f7412259ab"></span><span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">misc_settings</span></span></span><a class="headerlink" href="#c.TO_i2c_config_s.misc_settings" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Misc. device I2C settings bitfield: | RES | RES | RES | RES | RES | RES | RES | last byte NACKed | </p>
</dd></dl>

</div>
</dd></dl>

<dl class="c type">
<dt class="sig sig-object c" id="c.TO_i2c_config_t">
<span class="target" id="TODRV__HSE__i2c__wrapper_8h_1ac85873249ea7e280112f3108963d8845"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><a class="reference internal" href="#c.TO_i2c_config_s" title="TO_i2c_config_s"><span class="n"><span class="pre">TO_i2c_config_s</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TO_i2c_config_t</span></span></span><a class="headerlink" href="#c.TO_i2c_config_t" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>misc. settings bitfield definitions:</p>
<dl class="c macro">
<dt class="sig sig-object c" id="c.TO_CONFIG_NACK_LAST_BYTE">
<span class="target" id="TODRV__HSE__i2c__wrapper_8h_1afec5734122deb9ac4ba79a896d1b60fa"></span><span class="sig-name descname"><span class="n"><span class="pre">TO_CONFIG_NACK_LAST_BYTE</span></span></span> <span class="pre">0x01</span><a class="headerlink" href="#c.TO_CONFIG_NACK_LAST_BYTE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p><a class="reference internal" href="#structTO__i2c__config__s"><span class="std std-ref">TO_i2c_config_s</span></a> misc. setting: last byte is NACKed by remote device </p>
</dd></dl>

</div>
<div class="section" id="i2c-bus-setup">
<h2>I2C bus setup<a class="headerlink" href="#i2c-bus-setup" title="Permalink to this headline">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.TO_data_init">
<span class="target" id="TODRV__HSE__i2c__wrapper_8h_1a49ca21e47e618def9621a2556a380872"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TO_data_init</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TO_data_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Initialize Secure Element communication bus session. </p>
<p>Initializes I2C bus for Secure Element communications. If required, this is the recommended place to handle SecureElement power-on.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>TO_OK if initialization was successful, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TO_data_fini">
<span class="target" id="TODRV__HSE__i2c__wrapper_8h_1ae0e9d63cb6368b58a971ad27c0045943"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TO_data_fini</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TO_data_fini" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Finish Secure Element communication bus session. </p>
<p>Reset (stop) I2C bus used for Secure Element communications. If required, this is the recommended place to handle SecureElement power-off.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>TO_OK if reset was successful, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TO_data_config">
<span class="target" id="TODRV__HSE__i2c__wrapper_8h_1a7447699b69a6cdfeb3f77300d44684c2"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TO_data_config</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="#c.TO_i2c_config_t" title="TO_i2c_config_t"><span class="n"><span class="pre">TO_i2c_config_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">config</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TO_data_config" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>I2C configuration (optional function) </p>
<p>
Take given I2C configuration and apply it on the I2C wrapper. If the function returns successfully, it means the configuration has been applied and taken into account. The wrapper must NOT assume this function will be called, and must run correctly even if this function is never used.</p>
<p>This function is optional, and even if enabled by TODRV_HSE_I2C_WRAPPER_CONFIG it can still return TO_OK without doing anything. It is left to the wrapper developer discretion. This function is not called internally by TO library.</p>
<p>See <a class="reference internal" href="#structTO__i2c__config__s"><span class="std std-ref">TO_i2c_config_s</span></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – I2C configuration to use</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if configuration has been applied, else TO_ERROR </p>
</dd>
</dl>
</dd></dl>

<p>This function uses the following structure to receive settings:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TO_data_config() API is not mandatory, if you don’t need it do
not define TO_I2C_WRAPPER_CONFIG in your project preprocessor flags.</p>
</div>
</div>
<div class="section" id="data-transfers">
<h2>Data transfers<a class="headerlink" href="#data-transfers" title="Permalink to this headline">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.TO_data_read">
<span class="target" id="TODRV__HSE__i2c__wrapper_8h_1ab8153aca65895de50769cf000bc63c0e"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TO_data_read</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">length</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TO_data_read" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Read data from Secure Element on I2C bus. </p>
<p>
Reads specified amount of data from the Secure Element on I2C bus. This function returns when data has been read and is available in the data buffer, or if an error occured. The condition start has to be sent only one time to read the full Secure Element response, the reading can not be divided.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – Buffer to store received data </p></li>
<li><p><strong>length</strong> – Amount of data to read in bytes</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if data has been read sucessfully TO_DEVICE_READ_ERROR: error reading data from Secure Element TO_ERROR if an internal error has occured </p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.TO_data_write">
<span class="target" id="TODRV__HSE__i2c__wrapper_8h_1a7fcd29efe1806ea31834fe2e031d42d3"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TO_data_write</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">data</span></span>, <span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n"><span class="pre">length</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TO_data_write" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Write data to Secure Element on I2C bus. </p>
<p>
Writes specified amount of data to the Secure Element on I2C bus. This function returns when all data in the buffer has been written, or if an error occured. The condition start has to be sent only one time to write the full Secure Element command, the writing can not be divided.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – Buffer containing data to send </p></li>
<li><p><strong>length</strong> – Amount of data to send in bytes</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if data has been written sucessfully TO_DEVICE_WRITE_ERROR: error writing data to Secure Element TO_ERROR if an internal error has occured </p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.TO_data_last_command_duration">
<span class="target" id="TODRV__HSE__i2c__wrapper_8h_1af2eca4a8d7f647989dd3609ecd106caf"></span><a class="reference internal" href="defs.html#c.TO_lib_ret_t" title="TO_lib_ret_t"><span class="n"><span class="pre">TO_lib_ret_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">TO_data_last_command_duration</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">unsigned</span></span><span class="w"> </span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">duration</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.TO_data_last_command_duration" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Get last command duration (from I2C send to I2C receive) </p>
<p>
Measure the delay of the last executed command with MCU point of view. This function is optional, if implemented you have to define TODRV_HSE_I2C_WRAPPER_LAST_COMMAND_DURATION in your project in order to use it through TO_last_command_duration() API.</p>
<p>This function should only be called after a successful TO_read() call. If it is called after a failed TO_read(), or after a TO_write() call, the result is unspecified and may be irrelevant.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>duration</strong> – Pointer to store last command duration in microseconds</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>TO_OK if last command duration is available TO_ERROR if an internal error has occured </p>
</dd>
</dl>
</dd></dl>

</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2017, Trusted Objects.
      
    </div>

    

    
  </body>
</html>